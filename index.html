<!doctype html>
<!--
  ZP (Zombie Pixel) — Public SMP single-file site
  ✅ Rank-based QR payments (amount auto-locks)
  ✅ Requires payment before IGN appears in Admin
  ✅ Admin panel (username & password not in plain text)
  ✅ Manage ranks, prices, links; view history; export CSV
  ✅ Modern UI, smooth animations, responsive
  ✅ Discord & YouTube integration (editable)
  NOTE: This is a static file; "security" is best-effort (hashed creds).
-->
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="theme-color" content="#0b0c0f" />
<title>Zombie Pixel — Public SMP</title>
<meta name="description" content="Zombie Pixel • Public SMP • Fair Survival • Rank Store • Active Staff.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b0c0f; --bg2:#121319; --card:#141622; --glass:rgba(255,255,255,.06);
  --bd:rgba(255,255,255,.12); --txt:#ffffff; --muted:#bfc3cd;
  --gold:#f7b928; --gold2:#d98c0a; --ok:#1FE6A3; --warn:#ffd34d; --bad:#ff546b;
  --r:18px; --shadow:0 22px 60px rgba(0,0,0,.45);
}
*{box-sizing:border-box}
html,body{margin:0}
body{
  font-family:Poppins,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--txt); background:radial-gradient(1300px 700px at 10% -10%,rgba(247,185,40,.18),transparent 55%),
             radial-gradient(900px 520px at 110% -20%,rgba(217,140,10,.18),transparent 55%),
             linear-gradient(180deg,#090a0d,#0b0c0f 30%,#0a0b10);
  overflow-x:hidden;
}
a{color:inherit;text-decoration:none}
.container{width:92%;max-width:1200px;margin:0 auto}
button,.btn{font-family:inherit}

.btn{
  display:inline-flex;align-items:center;gap:.55rem;padding:.75rem 1rem;border-radius:14px;border:0;cursor:pointer;
  font-weight:800;background:linear-gradient(45deg,var(--gold),#ffe08a);color:#111;box-shadow:0 14px 30px rgba(247,185,40,.32);
  transition:transform .15s ease, filter .2s ease;
}
.btn:hover{transform:translateY(-1px)}
.btn.ghost{background:transparent;color:var(--gold);border:2px solid var(--gold)}
.btn.danger{background:linear-gradient(45deg,#ff7b95,#ff4d6d);color:white}
.badge{display:inline-flex;gap:.4rem;align-items:center;background:rgba(255,255,255,.07);border:1px solid var(--bd);padding:.45rem .7rem;border-radius:999px}

header{position:sticky;top:0;z-index:60;background:rgba(13,14,18,.78);backdrop-filter:blur(10px);border-bottom:1px solid var(--bd)}
.header{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
.brand{display:flex;gap:.75rem;align-items:center}
.brand .name{background:linear-gradient(45deg,#ffe08a,var(--gold));-webkit-background-clip:text;background-clip:text;color:transparent;font-weight:900;letter-spacing:.3px}
.brand small{opacity:.8}
#logoSmall{height:46px;width:46px;border-radius:50%;object-fit:cover;box-shadow:0 0 24px rgba(247,185,40,.55)}

.nav{display:flex;gap:.6rem;align-items:center}
.nav a{padding:.45rem .65rem;border-radius:10px}
.nav a:hover{background:rgba(255,215,0,.12)}
.hamb{display:none;flex-direction:column;gap:4px;cursor:pointer}
.hamb span{width:26px;height:2px;background:#fff;border-radius:2px}
@media (max-width:900px){ .nav{display:none} .hamb{display:flex} }

/* Drawer */
.drawer{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:none}
.drawer .panel{position:absolute;right:0;top:0;height:100%;width:min(86%,360px);background:#0f1118;border-left:1px solid var(--bd);padding:1rem;overflow:auto}
.drawer a{display:block;padding:.9rem;border-radius:12px;border:1px solid var(--bd);margin:.5rem 0}
.drawer .close{position:absolute;left:8px;top:6px;font-size:28px;cursor:pointer;color:#aaa}

/* Hero */
.hero{position:relative;padding:7.5rem 0 4rem;border-bottom:1px solid var(--bd)}
.hero .logo{width:100px;height:100px;border-radius:28px;object-fit:cover;box-shadow:0 0 46px rgba(247,185,40,.45)}
.hero h1{font-size:clamp(28px,5vw,50px);margin:.6rem 0 0}
.hero .sub{opacity:.9;margin:.35rem 0 1rem}
.ip{display:flex;gap:.5rem;align-items:center;background:rgba(255,255,255,.06);border:1px solid var(--bd);padding:.6rem .8rem;border-radius:12px;flex-wrap:wrap}

/* Sections */
.section{padding:3rem 0;border-bottom:1px solid var(--bd)}
.section-title{margin:0 0 1rem;color:var(--gold)}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
.card{grid-column:span 12;background:linear-gradient(180deg,#0d0f16,#151a24);border:1px solid var(--bd);border-radius:var(--r);box-shadow:var(--shadow);padding:1rem}
.note{color:var(--muted);font-size:.95rem}

/* Ranks */
.ranks{grid-column:span 12;display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
.rank{grid-column:span 6;background:linear-gradient(180deg,#10131b,#181d27);border:1px solid var(--bd);border-radius:var(--r);padding:1rem;display:grid;grid-template-columns:64px 1fr auto;gap:12px;align-items:center;position:relative;overflow:hidden}
.rank::after{content:"";position:absolute;inset:auto -20% -40% -20%;height:60%;background:radial-gradient(400px 120px at 50% 0,rgba(247,185,40,.14),transparent 70%)}
.rank .emblem{height:54px;width:54px;border-radius:16px;display:grid;place-items:center;background:linear-gradient(45deg,#ffe08a,var(--gold))}
.rank .name{font-weight:800}
.rank .price{font-weight:800;color:#ffe08a}
.rank .controls{display:flex;gap:.5rem}

/* Status/About */
.status{display:flex;gap:.6rem;flex-wrap:wrap}
#dot{width:10px;height:10px;border-radius:50%;display:inline-block}

/* Modal */
.modal{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;padding:1rem}
.modal .box{width:min(760px,96%);background:#0f1118;border:1px solid var(--bd);border-radius:18px;padding:1rem}
.modal .close{float:right;font-size:28px;cursor:pointer;color:#aaa}
.field{margin:.75rem 0}
.field label{display:block;margin-bottom:.35rem;color:var(--gold);font-weight:900}
.field input, .field select, .field textarea{width:100%;padding:.9rem;border-radius:12px;border:1px solid var(--bd);background:rgba(255,255,255,.05);color:var(--txt);outline:none}
.field input:focus, .field select:focus, .field textarea:focus{box-shadow:0 0 0 9px rgba(247,185,40,.12);border-color:var(--gold)}
.qr{margin:.7rem auto 0;max-width:240px;background:#fff;padding:10px;border-radius:12px;border:2px solid var(--gold);display:grid;place-items:center}
.qr small{color:#111;margin-top:.35rem}

/* Panel */
.panel{display:none;background:linear-gradient(180deg,#0d0f16,#151a24);border:1px solid var(--bd);border-radius:18px;margin:2rem auto;max-width:1200px;padding:1rem}
table{width:100%;border-collapse:collapse}th,td{padding:.65rem;border-bottom:1px solid rgba(255,255,255,.08);text-align:left}
th{color:var(--gold);background:rgba(255,255,255,.02)}
.admin-toggle{position:fixed;right:18px;bottom:18px}

/* Reveal */
.reveal{opacity:0;transform:translateY(16px);transition:opacity .5s ease, transform .5s ease}
.reveal.show{opacity:1;transform:none}

/* Footer */
footer{padding:2rem 0;background:#090a0d;border-top:1px solid var(--bd);text-align:center;color:var(--muted)}
.icon{display:inline-flex;align-items:center;gap:.4rem}
.icon svg{width:18px;height:18px}
</style>
</head>
<body>

<header>
  <div class="container header">
    <div class="brand">
      <img id="logoSmall" alt="Zombie Pixel Logo" src="https://image2url.com/images/1756202136345-ea1ce6b7-e122-4b66-ba58-08bc3c78f54a.webp">
      <div>
        <div class="name">Zombie Pixel</div>
        <small>Public SMP • Rank Store</small>
      </div>
    </div>
    <nav class="nav">
      <a href="#home">Home</a>
      <a href="#ranks">Ranks</a>
      <a href="#smp">Public SMP</a>
      <a href="#status">Status</a>
      <a href="#vote">Vote</a>
      <a href="#rules">Rules</a>
      <a id="discordTop" target="_blank" rel="noopener" href="https://discord.gg/eETvXzA7Sw" class="icon">
        <!-- simple discord icon -->
        <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M20.317 4.369A19.91 19.91 0 0 0 16.558 3c-.2.367-.43.86-.59 1.25a17.172 17.172 0 0 0-7.936 0C7.37 3.86 7.14 3.367 6.94 3A19.9 19.9 0 0 0 3.18 4.369c-2.04 3.046-2.9 6.022-2.59 8.95 2.46 1.815 4.85 2.92 7.2 3.63.58-.79 1.1-1.64 1.55-2.53- .86-.33-1.68-.74-2.46-1.22.2-.14.4-.28.6-.42a13.7 13.7 0 0 0 11.04 0c.2.14.4.28.6.42-.78.48-1.6.89-2.47 1.22.45.89.97 1.74 1.56 2.53 2.35-.71 4.73-1.82 7.2-3.63.36-3.35-.61-6.29-2.55-8.95ZM8.8 13.5c-1 0-1.82-.92-1.82-2.06 0-1.14.8-2.06 1.82-2.06s1.83.92 1.83 2.06-.82 2.06-1.83 2.06Zm6.42 0c-1 0-1.82-.92-1.82-2.06 0-1.14.82-2.06 1.82-2.06 1.02 0 1.83.92 1.83 2.06s-.8 2.06-1.83 2.06Z"/></svg>
        Discord
      </a>
      <a class="btn" href="#ranks">Buy</a>
    </nav>
    <div id="hamb" class="hamb" aria-label="Open menu" role="button" tabindex="0"><span></span><span></span><span></span></div>
  </div>
</header>

<!-- Drawer -->
<div id="drawer" class="drawer" aria-hidden="true" aria-label="Side menu">
  <div role="button" class="close" onclick="closeDrawer()">×</div>
  <div class="panel">
    <a href="#home" onclick="closeDrawer()">Home</a>
    <a href="#ranks" onclick="closeDrawer()">Ranks</a>
    <a href="#smp" onclick="closeDrawer()">Public SMP</a>
    <a href="#status" onclick="closeDrawer()">Status</a>
    <a href="#vote" onclick="closeDrawer()">Vote</a>
    <a href="#rules" onclick="closeDrawer()">Rules</a>
    <a id="discordDrawer" target="_blank" rel="noopener" onclick="closeDrawer()" href="https://discord.gg/eETvXzA7Sw">Discord</a>
    <a class="btn" href="#ranks" onclick="closeDrawer()">Buy</a>
  </div>
</div>

<!-- Hero -->
<section id="home" class="hero">
  <canvas id="bgCanvas" aria-hidden="true"></canvas>
  <div class="hero-inner container reveal show">
    <img class="logo" alt="Zombie Pixel" src="https://image2url.com/images/1756202136345-ea1ce6b7-e122-4b66-ba58-08bc3c78f54a.webp">
    <h1>Zombie Pixel</h1>
    <p class="sub">Public SMP • Events • Fair Play • Active Staff • Community Giveaways</p>
    <div class="ip">
      <strong id="serverIpTxt">play.zombiepixel.fun</strong>
      <a id="copyIp" class="btn" role="button">Copy IP</a>
      <a class="btn" id="trailerBtn" target="_blank" rel="noopener" href="https://youtube.com/@officialtonightgamerz?si=FPB7CzrrLJEE6ia1">Watch Trailer</a>
      <a class="btn" id="discordBtn" target="_blank" rel="noopener" href="https://discord.gg/eETvXzA7Sw">Discord</a>
    </div>
  </div>
</section>

<!-- Ranks -->
<section id="ranks" class="section">
  <div class="container reveal">
    <h2 class="section-title">Rank Shop</h2>
    <div class="note" style="margin:.3rem 0 1rem">Choose your rank, enter your IGN, scan or open UPI. Amount is auto-locked.</div>
    <div id="ranksWrap" class="ranks"></div>
  </div>
</section>

<!-- Public SMP -->
<section id="smp" class="section">
  <div class="container reveal grid">
    <div class="card" style="grid-column:span 7">
      <h3>About Our Public SMP</h3>
      <ul class="note" style="margin:.4rem 0; padding-left:1rem; line-height:1.7">
        <li>Season-based survival with economy & claims.</li>
        <li>Daily quests, crates, and player shops.</li>
        <li>No pay-to-win: ranks are cosmetic & QoL.</li>
        <li>Crossplay: Java & Bedrock supported via Geyser.</li>
        <li>Grief protection, anticheat, and active moderation.</li>
      </ul>
      <div class="badge"><b>Tip:</b> Use <code>/vote</code> for keys & coins!</div>
    </div>
    <div class="card" style="grid-column:span 5">
      <h3>How to Join</h3>
      <ol class="note" style="margin:.4rem 0; padding-left:1rem">
        <li>Copy IP → <b id="serverIpTxt2">play.zombiepixel.fun</b></li>
        <li>Minecraft 1.20+ (Bedrock: search “Servers → Add Server”).</li>
        <li>Read <a href="#rules" style="text-decoration:underline">Rules</a> before playing.</li>
      </ol>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem">
        <a class="btn" href="#ranks">Rank Shop</a>
        <a class="btn" id="channelBtn" target="_blank" rel="noopener" href="https://youtube.com/@officialtonightgamerz?si=FPB7CzrrLJEE6ia1">Channel</a>
      </div>
    </div>
  </div>
</section>

<!-- Status -->
<section id="status" class="section">
  <div class="container reveal grid">
    <div class="card" style="grid-column:span 7">
      <h3>Server Status</h3>
      <div class="status">
        <div class="badge"><span id="dot" style="background:#1FE6A3"></span> <b id="state">Online</b></div>
        <div class="badge">Players: <b id="players">42</b></div>
        <div class="badge">Ping: <b id="ping">56</b> ms</div>
        <div class="badge">MOTD: <b id="motd">Zombie Pixel • Stay Alive!</b></div>
      </div>
    </div>
    <div class="card" style="grid-column:span 5">
      <h3>Quick Links</h3>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap">
        <a id="trailerBtn2" class="btn" href="https://youtube.com/@officialtonightgamerz?si=FPB7CzrrLJEE6ia1" target="_blank">Trailer</a>
        <a id="discordBtn2" class="btn" href="https://discord.gg/eETvXzA7Sw" target="_blank">Discord</a>
      </div>
    </div>
  </div>
</section>

<!-- Vote / Rules -->
<section id="vote" class="section">
  <div class="container reveal">
    <h2 class="section-title">Vote & Support</h2>
    <div class="grid">
      <div class="card">
        <h3>Vote Links</h3>
        <p class="note">Add vote site links in Admin → Settings.</p>
        <div id="voteLinks" style="display:flex;gap:.6rem;flex-wrap:wrap"></div>
      </div>
      <div class="card" id="rules">
        <h3>Rules</h3>
        <ul class="note" style="margin:.4rem 0; padding-left:1rem; line-height:1.7">
          <li>No hacking, duping, or exploiting bugs.</li>
          <li>No griefing outside war/raids (follow claim rules).</li>
          <li>Be respectful. No harassment, slurs, or spam.</li>
          <li>Trading IRL money for items is not allowed.</li>
          <li>Staff decisions are final. Appeals on Discord.</li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- Buy Modal -->
<div id="buyModal" class="modal" role="dialog" aria-modal="true" aria-label="Checkout">
  <div class="box">
    <span class="close" onclick="closeBuy()">×</span>
    <h2 style="color:var(--gold);margin-top:.2rem">Checkout</h2>
    <div class="field"><label>Rank</label><input id="selRank" disabled></div>
    <div class="field"><label>Price</label><input id="selPrice" disabled></div>
    <div class="field"><label>IGN (required before payment)</label><input id="ign" placeholder="Your Minecraft username"></div>

    <div class="card"><b>Steps</b>: 1) Enter IGN → 2) Tap <i>Open UPI</i> / Scan QR (amount auto-locked) → 3) Pay → 4) Enter UTR → 5) Confirm.</div>

    <div class="field" style="text-align:center">
      <div class="qr" id="qrWrap" style="display:none">
        <img id="qrImg" alt="UPI QR" style="max-width:100%;height:auto">
        <small id="qrNote">Scan to pay with any UPI app</small>
      </div>
      <a id="payNow" class="btn" style="margin-top:.6rem;display:none" target="_blank" rel="noopener">Open UPI</a>
      <div class="note" style="margin-top:.6rem">After payment, paste <b>UTR</b> below and press <i>I’ve paid</i>.</div>
    </div>

    <div class="field"><label>UTR</label><input id="utr" placeholder="Bank reference (UTR)" maxlength="24"></div>
    <button id="confirmBtn" class="btn" onclick="confirmPaid()" disabled>I’ve paid</button>
  </div>
</div>

<!-- Admin Login -->
<div id="loginModal" class="modal" role="dialog" aria-modal="true" aria-label="Admin login">
  <div class="box">
    <span class="close" onclick="closeLogin()">×</span>
    <h2 style="color:var(--gold);margin-top:.2rem">Admin Login</h2>
    <div class="field"><label>Username</label><input id="admU" placeholder="Admin username"></div>
    <div class="field"><label>Password</label><input id="admP" type="password" placeholder="Admin password"></div>
    <button class="btn" onclick="adminLogin()">Login</button>
    <div id="loginErr" class="note" style="display:none;color:#ff7b95">Invalid credentials</div>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel" class="panel">
  <h2 style="color:var(--gold);margin-top:0">Admin Panel</h2>

  <div class="card">
    <h3 style="margin:.2rem 0 1rem;color:var(--gold)">Site Settings</h3>
    <div class="grid">
      <div class="field" style="grid-column:span 6"><label>Server IP</label><input id="cfg_ip"></div>
      <div class="field" style="grid-column:span 6"><label>Default UPI ID</label><input id="cfg_upi" placeholder="example@upi"></div>
      <div class="field" style="grid-column:span 6"><label>Discord Invite</label><input id="cfg_discord"></div>
      <div class="field" style="grid-column:span 6"><label>YouTube Trailer Link</label><input id="cfg_trailer" placeholder="https://youtu.be/..."></div>
      <div class="field" style="grid-column:span 6"><label>YouTube Channel Link</label><input id="cfg_channel"></div>
      <div class="field" style="grid-column:span 12"><label>Vote Links (one per line)</label><textarea id="cfg_votes" rows="4" placeholder="https://topg.org/...\nhttps://minecraft-mp.com/..."></textarea></div>
    </div>
    <div class="inline" style="margin-top:.6rem;display:flex;gap:.6rem;align-items:center;flex-wrap:wrap">
      <button class="btn" onclick="saveSiteConfig()">Save Settings</button>
      <span class="note">Saved in your browser (localStorage) & applied instantly.</span>
    </div>
  </div>

  <div class="card" style="margin:1rem 0">
    <h3 style="color:var(--gold);margin:.2rem 0 1rem">Ranks (editable)</h3>
    <div id="rankAdmin" class="grid"></div>
    <div class="inline" style="margin-top:.6rem;display:flex;gap:.6rem;flex-wrap:wrap">
      <button class="btn" onclick="addRankAdmin()">Add Rank</button>
      <button class="btn ghost" onclick="saveRanks()">Save Ranks</button>
    </div>
  </div>

  <h3 style="color:var(--gold)">Purchase History</h3>
  <div style="display:flex;gap:.6rem;flex-wrap:wrap;align-items:center;margin:.5rem 0 1rem">
    <label><input type="checkbox" id="filterCompleted"> Only <b>Completed</b></label>
    <input id="searchIGN" placeholder="Search IGN…" style="padding:.6rem .75rem;border-radius:12px;border:1px solid var(--bd);background:rgba(255,255,255,.05);color:var(--txt)">
    <button class="btn ghost" onclick="exportCSV()">Export CSV</button>
  </div>
  <div class="card">
    <div class="grid">
      <div class="field" style="grid-column:span 4"><label>Total Purchases</label><input id="statCount" disabled></div>
      <div class="field" style="grid-column:span 4"><label>Total Revenue (₹)</label><input id="statRevenue" disabled></div>
      <div class="field" style="grid-column:span 4"><label>Last UTR</label><input id="statLast" disabled></div>
    </div>
  </div>
  <div class="card" style="margin-top:1rem">
    <div style="overflow:auto">
      <table id="purchTable">
        <thead><tr><th>Date</th><th>IGN</th><th>Rank</th><th>Price</th><th>Status</th><th>UTR</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<button class="btn admin-toggle" onclick="openLogin()">Admin</button>

<footer>
  © <span id="yr"></span> Zombie Pixel • All rights reserved •
  <a id="discordFoot" target="_blank" href="https://discord.gg/eETvXzA7Sw" class="icon">Discord</a> •
  <a id="ytFoot" target="_blank" href="https://youtube.com/@officialtonightgamerz?si=FPB7CzrrLJEE6ia1" class="icon">YouTube</a>
</footer>

<script>
/* -------- tiny helpers -------- */
const els = (s, r=document)=>[...r.querySelectorAll(s)];
const $  = (s, r=document)=>r.querySelector(s);

/* -------- storage -------- */
const DB = {
  get(k, d){ try{ return JSON.parse(localStorage.getItem(k)) ?? d }catch{return d}},
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)) }
};

/* -------- defaults -------- */
const DEFAULT_CONFIG = {
  ip: "play.zombiepixel.fun",
  // your UPI shown in the screenshot:
  upi: "9149977246@fam",
  discord: "https://discord.gg/eETvXzA7Sw",
  trailer: "https://youtube.com/@officialtonightgamerz?si=FPB7CzrrLJEE6ia1",
  channel: "https://youtube.com/@officialtonightgamerz?si=FPB7CzrrLJEE6ia1",
  votes: ["# Add vote links in Admin → Settings"]
};
const DEFAULT_RANKS = [
  {name:"Legend", price:1000, upi:""},
  {name:"Mythic", price:500, upi:""},
  {name:"Elite", price:300, upi:""},
  {name:"Hero", price:200, upi:""},
  {name:"Knight", price:100, upi:""},
  {name:"Member+", price:50, upi:""}
];

let CONFIG = DB.get("zp2_config", DEFAULT_CONFIG);
let RANKS  = DB.get("zp2_ranks", DEFAULT_RANKS);
let PURCHASES = DB.get("zp2_purchases", []);

/* -------- UI boot -------- */
function applyConfig(){
  $("#serverIpTxt").textContent = CONFIG.ip;
  $("#serverIpTxt2").textContent = CONFIG.ip;
  $("#copyIp").onclick = ()=>{ navigator.clipboard.writeText(CONFIG.ip); $("#copyIp").textContent="Copied!"; setTimeout(()=>$("#copyIp").textContent="Copy IP",900) };
  $("#trailerBtn").href = CONFIG.trailer;
  $("#trailerBtn2").href = CONFIG.trailer;
  $("#channelBtn").href = CONFIG.channel;
  $("#discordBtn").href = CONFIG.discord;
  $("#discordBtn2").href = CONFIG.discord;
  $("#discordTop").href = CONFIG.discord;
  $("#discordFoot").href = CONFIG.discord;
  $("#ytFoot").href = CONFIG.channel;

  // vote links
  const wrap=$("#voteLinks"); wrap.innerHTML="";
  (CONFIG.votes||[]).forEach((v,i)=>{
    if(!v || v.trim().startsWith("#")) return;
    const a=document.createElement("a");
    a.className="btn ghost"; a.target="_blank"; a.rel="noopener"; a.href=v; a.textContent = "Vote #"+(i+1);
    wrap.appendChild(a);
  });
}
function renderRanks(){
  const wrap = $("#ranksWrap"); wrap.innerHTML="";
  RANKS.forEach((r,i)=>{
    const div=document.createElement("div");
    div.className="rank";
    div.innerHTML=`
      <div class="emblem">👑</div>
      <div><div class="name">${r.name}</div><div class="note">Cosmetic & QoL perks</div></div>
      <div class="price">₹${r.price}</div>
      <div class="controls"><button class="btn" onclick="openBuy(${i})">Buy</button></div>
    `;
    wrap.appendChild(div);
  });
}

/* -------- drawer -------- */
$("#hamb").onclick = ()=>{ $("#drawer").style.display="block"; $("#drawer").ariaHidden="false"; };
function closeDrawer(){ $("#drawer").style.display="none"; $("#drawer").ariaHidden="true"; }

/* -------- particles bg -------- */
(function(){
  const c=document.getElementById("bgCanvas"), ctx=c.getContext("2d");
  function resize(){ c.width=innerWidth; c.height=360 } resize(); addEventListener("resize",resize);
  const P=[]; const N=140;
  for(let i=0;i<N;i++){ P.push({x:Math.random()*c.width, y:Math.random()*c.height, vx:(Math.random()-.5)*.35, vy:(Math.random()-.5)*.35, r:Math.random()*2+1}); }
  function t(){
    ctx.clearRect(0,0,c.width,c.height);
    for(const p of P){
      p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>c.width) p.vx*=-1; if(p.y<0||p.y>c.height) p.vy*=-1;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle="rgba(247,185,40,.45)"; ctx.fill();
    } requestAnimationFrame(t);
  } t();
})();

/* -------- status mock -------- */
function randomStatus(){
  const up = Math.random()>0.08;
  $("#state").textContent = up? "Online":"Offline";
  $("#dot").style.background = up? "#1FE6A3":"#ff5c7a";
  $("#players").textContent = up? Math.floor(Math.random()*60)+10 : 0;
  $("#ping").textContent = up? Math.floor(Math.random()*120)+40 : "—";
  $("#motd").textContent = up? "Zombie Pixel • Stay Alive!" : "—";
}
setInterval(randomStatus, 30000);

/* -------- buy flow (rank-based QR) -------- */
let currentRank=null;
function openBuy(i){
  const r=RANKS[i]; currentRank=r;
  $("#selRank").value=r.name; $("#selPrice").value="₹"+r.price;
  $("#ign").value=""; $("#utr").value=""; $("#confirmBtn").disabled=true;
  // reset QR
  $("#qrWrap").style.display="none"; $("#payNow").style.display="none";
  $("#buyModal").style.display="flex";
}
function closeBuy(){ $("#buyModal").style.display="none"; }

function buildUPI(upi, amount, note){
  const p = new URLSearchParams({pa:upi, pn:"Zombie Pixel", am:String(amount), cu:"INR", tn:note});
  return "upi://pay?"+p.toString();
}
function updateQR(){
  const ign = $("#ign").value.trim();
  if(!currentRank || ign.length<3){ $("#qrWrap").style.display="none"; $("#payNow").style.display="none"; return; }
  const upi = (currentRank.upi && currentRank.upi.trim()) || CONFIG.upi || DEFAULT_CONFIG.upi;
  const upiURL = buildUPI(upi, currentRank.price, `${currentRank.name}-${ign}`);
  // show QR that ALWAYS loads
  $("#qrImg").src = "https://chart.googleapis.com/chart?cht=qr&chs=420x420&chl="+encodeURIComponent(upiURL);
  $("#qrWrap").style.display="grid";
  $("#payNow").href = upiURL; $("#payNow").style.display="inline-flex";
  $("#qrNote").textContent = `UPI: ${upi}`;
}
$("#ign").addEventListener("input", updateQR);
$("#utr").addEventListener("input", ()=>{ $("#confirmBtn").disabled = ($("#utr").value.trim().length<6); });

function confirmPaid(){
  const ign=$("#ign").value.trim(); const utr=$("#utr").value.trim();
  if(!ign || utr.length<6){ alert("Enter IGN and valid UTR"); return; }
  PURCHASES.push({ts:Date.now(), ign, rank:currentRank.name, price:currentRank.price, utr, status:"Completed"});
  DB.set("zp2_purchases", PURCHASES);
  closeBuy(); renderPurchases(); calcStats(); alert("Payment recorded. Thank you!");
}

/* -------- admin auth (hashed, not plain text) -------- */
// Default admin: ZombieAdmin / Pixel@2025 (but stored hashed)
const ADMIN_DEFAULT_USER="ZombieAdmin";
const ADMIN_DEFAULT_PASS="Pixel@2025";
const HASH_KEY="zp2_admin_hash";

async function sha(t){
  const enc=new TextEncoder().encode(t);
  const h=await crypto.subtle.digest("SHA-256",enc);
  return [...new Uint8Array(h)].map(b=>b.toString(16).padStart(2,"0")).join("");
}
async function ensureAdminHash(){
  let h=DB.get(HASH_KEY,null);
  if(!h){
    h = { u: await sha(ADMIN_DEFAULT_USER), p: await sha(ADMIN_DEFAULT_PASS) };
    DB.set(HASH_KEY,h);
  }
  return h;
}
function openLogin(){ $("#loginModal").style.display="flex"; }
function closeLogin(){ $("#loginModal").style.display="none"; }

async function adminLogin(){
  const u=$("#admU").value.trim(), p=$("#admP").value;
  const h=await ensureAdminHash();
  if(await sha(u)===h.u && await sha(p)===h.p){
    $("#loginErr").style.display="none";
    $("#loginModal").style.display="none";
    $("#adminPanel").style.display="block";
    renderRankAdmin(); renderPurchases(); calcStats();
  }else{ $("#loginErr").style.display="block"; }
}

/* -------- admin: settings -------- */
function saveSiteConfig(){
  CONFIG = {
    ip: $("#cfg_ip").value.trim() || DEFAULT_CONFIG.ip,
    upi: $("#cfg_upi").value.trim() || DEFAULT_CONFIG.upi,
    discord: $("#cfg_discord").value.trim() || DEFAULT_CONFIG.discord,
    trailer: $("#cfg_trailer").value.trim() || DEFAULT_CONFIG.trailer,
    channel: $("#cfg_channel").value.trim() || DEFAULT_CONFIG.channel,
    votes: ($("#cfg_votes").value||"").split("\n").map(s=>s.trim()).filter(Boolean)
  };
  DB.set("zp2_config", CONFIG);
  applyConfig();
  alert("Saved.");
}
function renderRankAdmin(){
  // fill settings
  $("#cfg_ip").value = CONFIG.ip;
  $("#cfg_upi").value = CONFIG.upi;
  $("#cfg_discord").value = CONFIG.discord;
  $("#cfg_trailer").value = CONFIG.trailer;
  $("#cfg_channel").value = CONFIG.channel;
  $("#cfg_votes").value = (CONFIG.votes||[]).join("\n");

  // ranks grid
  const wrap = $("#rankAdmin"); wrap.innerHTML="";
  wrap.style.gridTemplateColumns="repeat(12,1fr)";
  RANKS.forEach((r,i)=>{
    const card=document.createElement("div");
    card.className="card";
    card.style.gridColumn="span 6";
    card.innerHTML=`
       <div class="field"><label>Name</label><input value="${r.name}" data-i="${i}" data-k="name"></div>
       <div class="field"><label>Price (₹)</label><input type="number" value="${r.price}" data-i="${i}" data-k="price"></div>
       <div class="field"><label>Custom UPI (optional for this rank)</label><input value="${r.upi||""}" data-i="${i}" data-k="upi" placeholder="leave blank to use default"></div>
       <div style="display:flex;gap:.5rem;flex-wrap:wrap">
         <button class="btn" data-i="${i}" data-act="dup">Duplicate</button>
         <button class="btn danger" data-i="${i}" data-act="del">Delete</button>
       </div>
    `;
    wrap.appendChild(card);
  });
  wrap.querySelectorAll("input").forEach(inp=>{
    inp.oninput = (e)=>{
      const i = +e.target.dataset.i, k=e.target.dataset.k;
      if(k==="price"){ RANKS[i][k] = Math.max(0, +e.target.value||0); }
      else RANKS[i][k] = e.target.value;
    };
  });
  wrap.querySelectorAll("button").forEach(btn=>{
    btn.onclick = (e)=>{
      const i = +e.target.dataset.i, act=e.target.dataset.act;
      if(act==="del"){ RANKS.splice(i,1); renderRankAdmin(); renderRanks(); }
      if(act==="dup"){ RANKS.splice(i+1,0,{...RANKS[i]}); renderRankAdmin(); renderRanks(); }
    };
  });
}
function addRankAdmin(){ RANKS.push({name:"New Rank", price:0, upi:""}); renderRankAdmin(); }
function saveRanks(){ DB.set("zp2_ranks", RANKS); renderRanks(); alert("Ranks saved."); }

/* -------- purchases table & stats -------- */
function renderPurchases(){
  const onlyCompleted = $("#filterCompleted").checked;
  const q = ($("#searchIGN").value||"").toLowerCase();
  const tbody = $("#purchTable tbody"); tbody.innerHTML="";
  PURCHASES
    .filter(p=>!onlyCompleted || p.status==="Completed")
    .filter(p=>p.ign.toLowerCase().includes(q))
    .sort((a,b)=>b.ts-a.ts)
    .forEach(p=>{
      const tr=document.createElement("tr");
      const d=new Date(p.ts).toLocaleString();
      tr.innerHTML=`<td>${d}</td><td>${p.ign}</td><td>${p.rank}</td><td>₹${p.price}</td>
        <td style="color:${p.status==='Completed'?'#1FE6A3':'#ffd34d'}">${p.status}</td><td>${p.utr}</td>`;
      tbody.appendChild(tr);
    });
}
$("#filterCompleted").onchange=renderPurchases;
$("#searchIGN").oninput=renderPurchases;

function calcStats(){
  $("#statCount").value = PURCHASES.length;
  $("#statRevenue").value = PURCHASES.reduce((s,p)=>s+(p.status==="Completed"?+p.price:0),0);
  $("#statLast").value = (PURCHASES[0]?.utr)||"—";
}
function exportCSV(){
  const rows=[["Date","IGN","Rank","Price","Status","UTR"]];
  PURCHASES.forEach(p=>rows.push([new Date(p.ts).toISOString(),p.ign,p.rank,p.price,p.status,p.utr]));
  const csv = rows.map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv],{type:"text/csv"}); const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="zp_purchases.csv"; a.click(); setTimeout(()=>URL.revokeObjectURL(url),500);
}

/* -------- reveal on scroll -------- */
function revealOnScroll(){ els(".reveal").forEach(e=>{ const r=e.getBoundingClientRect(); if(r.top<window.innerHeight-80) e.classList.add("show"); });}
addEventListener("scroll",revealOnScroll); addEventListener("load",revealOnScroll);

/* -------- boot -------- */
addEventListener("load", ()=>{
  $("#yr").textContent = new Date().getFullYear();
  applyConfig(); renderRanks(); randomStatus();
});
</script>
</body>
</html>
